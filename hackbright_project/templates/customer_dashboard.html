 
{% extends 'base.html' %}
{% block content %}

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<style>

.arc text {
  font: 10px sans-serif;
  text-anchor: middle;
}

.arc path {
  stroke: #fff;
}

</style>
<div id="cluster" style="min-width: 310px; height: 400px; max-width: 800px; margin: 0 auto"></div>

<div class="btn-group btn-group-sm" role="group" aria-label="...">
  <button id= "cluster1" type="button" class="btn btn-default">Cluster1</button>
  <button id= "cluster2" type="button" class="btn btn-default">Cluster2</button>
  <button id="cluster3" type="button" class="btn btn-default">Cluster3</button>
</div>

<div id= "cluster-tabs">
  <div id= "cluster1-contents"></div>
  <div id= "cluster2-contents"></div>
  <div id= "cluster3-contents"></div>
</div>
 
 <script type="text/javascript">
 
   function populateClusterDiv(){
      $("cluster-tabs").empty();
      data = $.get("/clustering", function(data){
      console.log(typeof(data.data));
      output ="<ul><li>Negative tickets are "+data.data['cluster_info']['cluster1']['percent_negative'].toFixed(1)+"% negative</li></ul>";
      console.log(output);
      document.getElementById("cluster1-contents").innerHTML=output;
      });
    }

    // function showClusterDetails(evt){
    //     $("cluster-tabs").empty();

    // }

$('#cluster1').on('click', populateClusterDiv());
 
//  function changeCluster(e, cluster){
//         refreshAllCharts(cluster);
// }

// function refreshAllCharts(cluster){
//   $(cluster).empty();
//   alert('YAYYYY!');
// }
// $('#cluster1').click(changeCluster('#cluster1'), refreshAllCharts('#cluster1'));
// $('#cluster2').click(changeCluster('#cluster2'), refreshAllCharts('#cluster2'));
// $('#cluster3').click(changeCluster('#cluster3'), refreshAllCharts('#cluster3'));




// function renderCluster1(evt){
//    $('#cluster1-contents').empty();
//    json_route = 
//    renderClusterPositive()
    
// }

// function renderCluster2(evt){
//    $('#cluster2').empty();
//   $.get("/clustering");
//   $('#ticket_data').load('dashboard.html');
// }

// function renderCluster3(evt){
//    $('#cluster3').empty();
//   $.get("/clustering");
//   $('#ticket_data').load('dashboard.html');
// }

// function renderReportingTabs(){
// $(function() {
//     $( "#tabs" ).tabs();
//   });
// }
// function renderCluster1Positive(json_route, cluster){
// var width = 300,
//     height = 300,
//     radius = Math.min(width, height) / 2;

// var color = d3.scale.ordinal()
//     .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

// var arc = d3.svg.arc()
//     .outerRadius(radius - 10)
//     .innerRadius(radius - 70);

// var pie = d3.layout.pie()
//     .sort(null)
//     .value(function(d) { return d.percent_positive; });

// var svg = d3.select("#cluster1-contents").append("svg")
//     .attr("width", width)
//     .attr("height", height)
//   .append("g")
//     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

// json_route = "/clustering"
// d3.json(json_route, 

// function(error, data) {
//   if (error) throw error;

//   var g = svg.selectAll(".arc")
//       .data(pie(data.data))
//     .enter().append("g")
//       .attr("class", "arc");

//   g.append("path")
//       .attr("d", arc)
//       .style("fill", function(d) { return color(d.data.cluster_info.cluster1.percent_positive); });

//   g.append("text")
//       .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
//       .attr("dy", ".35em")
//       .text(function(d) { return d.data.cluster_info.cluster1.percent_positive; });
// });

// function type(d) {
//   d.population = +d.population;
//   return d;
// }

// renderCluster1Positive();

function renderClusterBarGraph(){
 data = $.get("/clustering", function(data){
 $(function () {
    $('#cluster').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Sentiment Analysis of Tickets by Cluster'
        },
        // subtitle: {
        //     text: 'Source: <a href="https://en.wikipedia.org/wiki/World_population">Wikipedia.org</a>'
        // },
        xAxis: {
            categories: ['Cluster 1', 'Cluster 2', 'Cluster 3'],
            title: {
                text: null
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Number of Tickets)',
                align: 'high'
            },
            labels: {
                overflow: 'justify'
            }
        },
        tooltip: {
        },
        plotOptions: {
            bar: {
                 dataLabels: {
                    enabled: true
            }
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            x: -40,
            y: 80,
            floating: true,
            borderWidth: 1,
            backgroundColor: ((Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'),
            shadow: true
        },
        credits: {
            enabled: false
        }

    },
        series: [{
            name: 'Positive',
            data: [data.data['cluster_labels']['cluster1']['pos'].length,data.data['cluster_labels']['cluster2']['pos'].length, data.data['cluster_labels']['cluster3']['pos'].length ]
        }, {
            name: 'Neutral',
            data: [data.data['cluster_labels']['cluster1']['neutral'].length, data.data['cluster_labels']['cluster2']['neutral'].length, data.data['cluster_labels']['cluster3']['neutral'].length ]
        }, {
            name: 'Negative',
            data: [data.data['cluster_labels']['cluster1']['neg'].length,data.data['cluster_labels']['cluster2']['neg'].length, data.data['cluster_labels']['cluster3']['neg'].length ]
        }]
 });
 
});
});
}
// renderReportingTabs();
renderClusterBarGraph();
 </script>

 {% endblock %}