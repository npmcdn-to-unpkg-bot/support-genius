 
{% extends 'base.html' %}
{% block content %}

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<style>

.arc text {
  font: 10px sans-serif;
  text-anchor: middle;
}

.arc path {
  stroke: #fff;
}

</style>
<div id="cluster" style="min-width: 310px; height: 400px; max-width: 800px; margin: 0 auto"></div>

<div class="btn-group btn-group-sm" role="group" aria-label="...">
  <button id= "cluster1" type="button" class="btn btn-default">Cluster1</button>
  <button id= "cluster2" type="button" class="btn btn-default">Cluster2</button>
  <button id="cluster3" type="button" class="btn btn-default">Cluster3</button>
</div>


  <div id= "cluster1-contents"></div>
  <div id= "cluster2-contents"></div>
  <div id= "cluster3-contents"></div>

 
 <script type="text/javascript">
   
   // function populateClusterDiv(evt, cluster, div_name){
   //    $("cluster-tabs").empty();
   //    data = $.get("/clustering", function(data){
   //    console.log(typeof(data.data));
   //    output ="<ul><li>Negative tickets are "+data.data['cluster_info'][cluster]['percent_negative'].toFixed(1)+"% negative</li><li>Positive tickets are "+data.data['cluster_info'][cluster]['percent_positive'].toFixed(1)+"% positive</li></ul>";
   //    document.getElementById(div_name).innerHTML=output;
   //    });
   //  }

$('#cluster1').on("click", populateClusterDiv1());
$('#cluster2').on("click", populateClusterDiv2());
$('#cluster3').on("click", populateClusterDiv3());
   
   function populateClusterDiv1(evt){
      // $("#cluster1-contents").empty();
      $("#cluster2-contents").empty();
      $("#cluster3-contents").empty();
      data = $.get("/cluster_details.json", function(data){
      output ="<ul><li>Negative tickets are "+data['data']['cluster1']['percent_negative'].toFixed(1)+"% negative</li><li>Positive tickets are "+data['data']['cluster1']['percent_positive'].toFixed(1)+"% positive</li></ul>";
      document.getElementById("cluster1-contents").html=output;
      });
    }

   function populateClusterDiv2(evt){
      $("#cluster1-contents").empty();
      // $("#cluster2-contents").empty();
      $("#cluster3-contents").empty();
      data = $.get("/cluster_details.json", function(data){
      output ="<ul><li>Negative tickets are "+data['data']['cluster2']['percent_negative'].toFixed(1)+"% negative</li><li>Positive tickets are "+data['data']['cluster2']['percent_positive'].toFixed(1)+"% positive</li></ul>";
      document.getElementById("cluster2-contents").html=output;
      });
    }

   function populateClusterDiv3(evt){
      $("#cluster1-contents").empty();
      $("#cluster2-contents").empty();
      // $("#cluster3-contents").empty();
      data = $.get("/cluster_details.json", function(data){
      output ="<ul><li>Negative tickets are "+data['data']['cluster3']['percent_negative'].toFixed(1)+"% negative</li><li>Positive tickets are "+data['data']['cluster3']['percent_positive'].toFixed(1)+"% positive</li></ul>";
      document.getElementById("cluster3-contents").html=output;
      });
    }


function renderClusterBarGraph(){
 data = $.get("/clustering.json", function(data){
 $(function () {
    $('#cluster').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Sentiment Analysis of Tickets by Cluster'
        },
        xAxis: {
            categories: ['Cluster 1', 'Cluster 2', 'Cluster 3'],
            title: {
                text: 'Customer Clusters'
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Number of Tickets',
                align: 'high'
            },
            labels: {
                overflow: 'justify'
            }
        },
        tooltip: {
        },
        plotOptions: {
            bar: {
                 dataLabels: {
                    enabled: true
            }
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            x: -40,
            y: 80,
            floating: true,
            borderWidth: 1,
            backgroundColor: ((Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'),
            shadow: true
        },
        credits: {
            enabled: false
        }

    },
        series: [{
            name: 'Positive',
            color: '#0cb577',
            data: [data.data['cluster1']['pos'].length,data.data['cluster2']['pos'].length, data.data['cluster3']['pos'].length ]
        }, {
            name: 'Neutral',
            color: "#67E40F",
            data: [data.data['cluster1']['neutral'].length, data.data['cluster2']['neutral'].length, data.data['cluster3']['neutral'].length ]
        }, {
            name: 'Negative',
            color: '#387BB8',
            data: [data.data['cluster1']['neg'].length,data.data['cluster2']['neg'].length, data.data['cluster3']['neg'].length ]
        }]
 });
 
});
 
});
}
// renderReportingTabs();
renderClusterBarGraph();
 </script>

 {% endblock %}